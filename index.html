<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ðŸ§­ Painel de GerÃªncia</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0f19;--card:#131b2b;--accent:#ff8f1f;--accent2:#ffb347;
  --text:#f1f5f9;--muted:#94a3b8;--success:#22c55e;--error:#ef4444;
  --shadow:0 4px 14px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter,Arial;background:var(--bg);color:var(--text);
  min-height:100vh;display:flex;flex-direction:column;
}
header{
  position:sticky;top:0;z-index:10;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#000;padding:14px;text-align:center;font-weight:700;
}
main{flex:1;padding:20px;max-width:1200px;margin:auto;width:100%}
.section{
  background:var(--card);border-radius:16px;padding:24px;
  box-shadow:var(--shadow);margin-bottom:20px;
}
h2{margin:0 0 14px;color:var(--accent2)}
.input,.select{
  width:100%;padding:12px;border-radius:10px;border:0;
  background:#1e293b;color:#fff;margin-bottom:10px;
}
.btn{
  padding:12px 16px;border-radius:10px;border:0;
  background:var(--accent);font-weight:700;cursor:pointer;
}
.btn:hover{background:var(--accent2)}
.error{color:var(--error);font-size:13px}

.cards{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:16px;margin-top:10px;
}
.card{
  background:#0f172a;border-radius:14px;padding:16px;
  box-shadow:var(--shadow);
}
.card h3{margin:0;color:var(--accent2)}
.card p{margin:6px 0 0;color:var(--muted);font-size:13px}

.fade{animation:fade .3s ease}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1}}
</style>
</head>

<body>
<header>ðŸ§­ Painel de GerÃªncia</header>

<main>

<!-- LOGIN -->
<div class="section fade" id="loginBox">
  <h2>IdentificaÃ§Ã£o</h2>
  <select id="usuario" class="select">
    <option value="">Selecione</option>
    <option>MERCATTO_DHEURE</option>
    <option>MERCATTO_YURI</option>
    <option>DELICIA_RUAN</option>
  </select>
  <input id="senha" class="input" type="password" placeholder="Senha">
  <button class="btn" onclick="login()">Entrar</button>
  <div class="error" id="loginMsg"></div>
</div>

<!-- DASHBOARD -->
<div class="section fade" id="dashBox" style="display:none">
  <h2 id="empresaTitulo"></h2>

  <!-- KPIs -->
  <div class="cards">
    <div class="card">
      <h3 id="kpiChecklist">â€“</h3>
      <p>Checklists hoje</p>
    </div>
    <div class="card">
      <h3 id="kpiManutencao">â€“</h3>
      <p>ManutenÃ§Ãµes abertas</p>
    </div>
    <div class="card">
      <h3 id="kpiDesperdicio">â€“</h3>
      <p>DesperdÃ­cio (perÃ­odo)</p>
    </div>
    <div class="card">
      <h3 id="kpiReservas">â€“</h3>
      <p>Reservas hoje</p>
    </div>
  </div>

  <button class="btn" style="margin-top:20px" onclick="logout()">Sair</button>
</div>

</main>

<script>
/* ================= SUPABASE ================= */
const SUPABASE_URL = 'https://qkuilafoughsaykttjsc.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_SCIIYvHVkFxUIs28r9Tw0A_jJEgCO3g';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ================= HELPERS ================= */
const $ = s => document.querySelector(s);
const hoje = () => new Date().toISOString().slice(0,10);

/* ================= LOGIN ================= */
function login(){
  const usuario = $('#usuario').value;
  const senha = $('#senha').value;
  if(!usuario || !senha){
    $('#loginMsg').textContent='Preencha tudo';
    return;
  }

  const [empresa, nome] = usuario.split('_');
  const empresaNome = empresa === 'MERCATTO' ? 'MERCATTO DELÃCIA' : 'DELÃCIA GOURMET';

  localStorage.setItem('empresa', empresaNome);
  localStorage.setItem('gerente', nome);

  $('#empresaTitulo').textContent = `${empresaNome} â€¢ ${nome}`;
  $('#loginBox').style.display='none';
  $('#dashBox').style.display='block';

  loadKPIs();
}

/* ================= LOGOUT ================= */
function logout(){
  localStorage.clear();
  location.reload();
}

/* ================= KPIs ================= */
async function loadKPIs(){
  await Promise.all([
    kpiChecklists(),
    kpiManutencoes(),
    kpiDesperdicios(),
    kpiReservas()
  ]);
}

async function kpiChecklists(){
  const { count } = await supabase
    .from('checklists')
    .select('*',{count:'exact',head:true})
    .eq('data',hoje());
  $('#kpiChecklist').textContent = count ?? 0;
}

async function kpiManutencoes(){
  const { count } = await supabase
    .from('manutencoes')
    .select('*',{count:'exact',head:true})
    .eq('status','aberto');
  $('#kpiManutencao').textContent = count ?? 0;
}

async function kpiDesperdicios(){
  const { data } = await supabase
    .from('desperdicios')
    .select('quantidade');
  const total = (data||[]).reduce((s,i)=>s+Number(i.quantidade),0);
  $('#kpiDesperdicio').textContent = total.toFixed(1);
}

async function kpiReservas(){
  const { count } = await supabase
    .from('reservas')
    .select('*',{count:'exact',head:true})
    .eq('data',hoje());
  $('#kpiReservas').textContent = count ?? 0;
}

/* ================= AUTOLOGIN ================= */
window.onload = ()=>{
  const empresa = localStorage.getItem('empresa');
  const gerente = localStorage.getItem('gerente');
  if(empresa && gerente){
    $('#empresaTitulo').textContent = `${empresa} â€¢ ${gerente}`;
    $('#loginBox').style.display='none';
    $('#dashBox').style.display='block';
    loadKPIs();
  }
};
</script>

</body>
</html>
